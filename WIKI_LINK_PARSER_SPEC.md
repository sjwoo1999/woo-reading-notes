# μ„ν‚¤λ§ν¬ νμ„ κµ¬ν„ μƒμ„Έ μ”κµ¬μ‚¬ν•­μ„

## π“‹ κ°μ”

λ…ΈνΈ μ‘μ„± μ‹ `[[λ…ΈνΈλ…]]` ν•μ‹μΌλ΅ λ‹¤λ¥Έ λ…ΈνΈλ¥Ό μ°Έμ΅°ν•  μ μκ² ν•λ” μ„ν‚¤λ§ν¬ κΈ°λ¥ κµ¬ν„

---

## π― ν•µμ‹¬ μ”κµ¬μ‚¬ν•­

### 1. μ„ν‚¤λ§ν¬ ν•μ‹ μ •μ

**λ¬Έλ²•**:
```
[[λ…ΈνΈλ…]]
[[λ…ΈνΈλ…|ν‘μ‹ν…μ¤νΈ]]
```

**μμ‹**:
```
μ΄κ²ƒμ€ [[Machine Learning]] κ°λ…μ…λ‹λ‹¤.
[[\ub14c\uc120 \ub137\uc6cc\ud06c|μ‹ κ²½λ§]] μ†κ°
```

**κ·μΉ™**:
- ν• κΈ€μ μ΄μƒ ν•„μ”
- νΉμλ¬Έμ ν—μ© (ν•κΈ€, μλ¬Έ, μ«μ, μ–Έλ”μ¤μ½”μ–΄, ν•μ΄ν”)
- λ€μ†λ¬Έμ κµ¬λ¶„ μ—†μ (κ²€μƒ‰ μ‹)
- ν• λ…ΈνΈμ— μ¤‘λ³µ κ°€λ¥

---

### 2. ν΄λΌμ΄μ–ΈνΈ κΈ°λ¥ (NoteForm.tsx)

#### 2.1 μ‹¤μ‹κ°„ μ„ν‚¤λ§ν¬ κ°μ§€ & ν•μ΄λΌμ΄ν…

```typescript
// content textareaμ—μ„ [[...]] ν¨ν„΄ κ°μ§€
// λ§¤μΉ­λλ” ν…μ¤νΈλ¥Ό κµ¬λ¶„λ μ¤νƒ€μΌλ΅ ν‘μ‹
```

**κµ¬ν„ μ„μΉ**:
- `src/lib/utils/wikiLinkParser.ts` - νμ„ μ ν‹Έλ¦¬ν‹° ν•¨μ
- `src/app/notes/NoteForm.tsx` - UI λ λ”λ§

**κΈ°λ¥**:
- νƒ€μ΄ν•‘ μ¤‘ μ‹¤μ‹κ°„ κ°μ§€
- μ¬λ°”λ¥Έ ν•μ‹: μ΄λ΅μƒ‰ ν•μ΄λΌμ΄νΈ
- λ―Έλ§¤μΉ­ λ§ν¬: μ£Όν™©μƒ‰ ν•μ΄λΌμ΄νΈ (κ²½κ³ )
- λ―Έλ¦¬λ³΄κΈ°: `[[λ…ΈνΈλ…]]` β†’ "λ…ΈνΈλ… λ§ν¬λ΅ ν‘μ‹"

#### 2.2 μλ™ μ μ• (Autocomplete)

```
μ‚¬μ©μκ°€ [[ μ…λ ¥ ν›„ ν‚¤λ³΄λ“μ—μ„ μ•„λλ΅ μ„ νƒ κ°€λ¥
Ctrl+K / Cmd+Kλ΅ κ°•μ  νΈλ¦¬κ±°
```

**λ™μ‘**:
1. μ‚¬μ©μκ°€ `[[` μ…λ ¥
2. μ…λ ¥ μ‹μ‘ (μ: `[[ma`)
3. μ„λ²„μ—μ„ λ§¤μΉ­λλ” λ…ΈνΈ κ²€μƒ‰ (PREFIX MATCH)
4. λ“λ΅­λ‹¤μ΄μΌλ΅ λ©λ΅ ν‘μ‹
5. μ„ νƒ μ‹ μλ™μ™„μ„±

**μ„±λ¥**:
- 300ms λ””λ°”μ΄μ¤ (μ…λ ¥ λ©μ¶ ν›„ κ²€μƒ‰)
- μµλ€ 10κ° κ²°κ³Ό
- ν„μ¬ λ…ΈνΈ μ μ™Έ

---

### 3. μ„λ²„ κΈ°λ¥

#### 3.1 μ„ν‚¤λ§ν¬ νμ‹± API

**μƒ μ—”λ“ν¬μΈνΈ**: `POST /api/notes/{id}/parse-wikilinks`

```typescript
// μ”μ²­
{
  "content": "μ΄κ²ƒμ€ [[ML]] κ°λ…μ΄κ³  [[μ‹ κ²½λ§]]μ„ μ‚¬μ©ν•©λ‹λ‹¤"
}

// μ‘λ‹µ
{
  "wikilinks": [
    {
      "text": "ML",
      "displayText": "ML",
      "foundNoteId": "uuid-1",
      "foundNoteTitle": "Machine Learning",
      "type": "exact" // exact, partial, notfound
    },
    {
      "text": "μ‹ κ²½λ§",
      "displayText": "μ‹ κ²½λ§",
      "foundNoteId": null,
      "foundNoteTitle": null,
      "type": "notfound"
    }
  ]
}
```

#### 3.2 μλ™μ™„μ„± API

**μƒ μ—”λ“ν¬μΈνΈ**: `GET /api/notes/autocomplete?q=ma&limit=10`

```typescript
// μ‘λ‹µ
[
  {
    "id": "uuid-1",
    "title": "Machine Learning",
    "type": "concept",
    "preview": "Overview of ML algorithms..."
  },
  {
    "id": "uuid-2",
    "title": "Mathematical Foundations",
    "type": "concept",
    "preview": "Math concepts used in ML..."
  }
]
```

**κ²€μƒ‰ λ΅μ§**:
1. PREFIX MATCH (μ λ© μ‹μ‘ λ¬Έμ λ§¤μΉ­) - λ†’μ€ μ°μ„ μμ„
2. CONTAINS MATCH (μ λ© λ‚΄ ν¬ν•¨) - λ‚®μ€ μ°μ„ μμ„
3. λ€μ†λ¬Έμ κµ¬λ¶„ μ• ν•¨
4. μ •λ ¬: μµκ·Ό μμ •μ

---

### 4. μ„ν‚¤λ§ν¬ μλ™ μƒμ„± (λ…ΈνΈ μ €μ¥ μ‹)

#### λ™μ‘ νλ¦„

```
μ‚¬μ©μκ°€ λ…ΈνΈ μ €μ¥
   β†“
1. λ‚΄μ©μ—μ„ λ¨λ“  [[...]] νμ‹±
   β†“
2. κ° μ„ν‚¤λ§ν¬μ— λ€ν•΄ λ…ΈνΈ κ²€μƒ‰
   - Exact match: μλ™ λ§ν¬ μƒμ„±
   - Partial match: μ‚¬μ©μμ—κ² ν™•μΈ μ”μ²­
   - No match: λ¬΄μ‹
   β†“
3. λ§ν¬ μƒμ„± (POST /api/links)
   - relationship_type: "relates_to" (κΈ°λ³Έκ°’)
```

#### μλ™ μƒμ„± κ·μΉ™

| κ²½μ° | λ™μ‘ |
|------|------|
| μ •ν™•ν μΌμΉν•λ” λ…ΈνΈ | μλ™ μƒμ„± |
| μ—¬λ¬ κ° λ¶€λ¶„ μΌμΉ | μ‚¬μ©μ μ„ νƒ |
| μΌμΉν•λ” λ…ΈνΈ μ—†μ | λ§ν¬ μƒμ„± μ• ν•¨ |
| μ΄λ―Έ μ΅΄μ¬ν•λ” λ§ν¬ | μ¤‘λ³µ μ μ™Έ |

---

### 5. λ…ΈνΈ μƒμ„Έ νμ΄μ§€ λ λ”λ§

#### λ³Έλ¬Έ λ λ”λ§

```typescript
// contentμ—μ„ [[λ…ΈνΈλ…]] κ°μ§€ λ° λ§ν¬λ΅ λ³€ν™
[[Machine Learning]] β†’ <Link href="/notes/uuid-1">Machine Learning</Link>

// ν΄λ¦­ μ‹ ν•΄λ‹Ή λ…ΈνΈλ΅ μ΄λ™
```

#### μ–‘λ°©ν–¥ λ§ν¬ ν‘μ‹

μ΄λ―Έ κµ¬ν„λ¨ (κ΄€λ ¨ λ…ΈνΈ & μ—­λ§ν¬)

---

## π“ νμΌ κµ¬μ΅°

```
src/
β”β”€β”€ lib/
β”‚   β””β”€β”€ utils/
β”‚       β””β”€β”€ wikiLinkParser.ts        # μ„ν‚¤λ§ν¬ νμ‹± μ ν‹Έλ¦¬ν‹°
β”β”€β”€ app/
β”‚   β”β”€β”€ notes/
β”‚   β”‚   β”β”€β”€ NoteForm.tsx             # νΌ μμ • (μλ™μ™„μ„±, ν•μ΄λΌμ΄νΈ)
β”‚   β”‚   β”β”€β”€ [id]/page.tsx            # λ§ν¬ λ λ”λ§ μ¶”κ°€
β”‚   β”‚   β””β”€β”€ WikiLinkPreview.tsx      # μ„ν‚¤λ§ν¬ ν”„λ¦¬λ·° μ»΄ν¬λ„νΈ
β”‚   β””β”€β”€ api/
β”‚       β”β”€β”€ notes/
β”‚       β”‚   β”β”€β”€ autocomplete/route.ts # μλ™μ™„μ„± API
β”‚       β”‚   β””β”€β”€ {id}/
β”‚       β”‚       β””β”€β”€ parse-wikilinks/route.ts
β”‚       β””β”€β”€ links/route.ts            # κΈ°μ΅΄ (μμ • λ¶ν•„μ”)
```

---

## π”§ κµ¬ν„ μμ„

1. **μ ν‹Έλ¦¬ν‹° ν•¨μ** (`wikiLinkParser.ts`)
   - μ •κ·μ‹μΌλ΅ μ„ν‚¤λ§ν¬ κ°μ§€
   - νμ‹± λ° κ²€μ¦
   - λ λ”λ§μ© HTML λ³€ν™

2. **μλ™μ™„μ„± API** (`/api/notes/autocomplete`)
   - PREFIX + CONTAINS κ²€μƒ‰
   - μµλ€ 10κ° λ°ν™

3. **λ…ΈνΈνΌ μλ™μ™„μ„±** (NoteForm.tsx)
   - λ“λ΅­λ‹¤μ΄ UI
   - 300ms λ””λ°”μ΄μ¤

4. **μ„ν‚¤λ§ν¬ λ λ”λ§** (λ…ΈνΈ μƒμ„Έ νμ΄μ§€)
   - contentμ—μ„ λ§ν¬λ΅ λ³€ν™
   - ν΄λ¦­ κ°€λ¥ν• λ§ν¬

5. **μλ™ λ§ν¬ μƒμ„±** (λ…ΈνΈ μ €μ¥ μ‹)
   - νμ‹± β†’ κ²€μƒ‰ β†’ ν™•μΈ β†’ μƒμ„± νλ¦„

6. **μ„ν‚¤λ§ν¬ ν•μ΄λΌμ΄ν…** (νΌ)
   - μ…λ ¥ μ¤‘ μ‹κ°μ  ν”Όλ“λ°±

---

## β… κ²€μ¦ κΈ°μ¤€

### μ •κ·μ‹ ν…μ¤νΈ

```typescript
// λ§¤μΉ­λμ–΄μ•Ό ν•λ” ν¨ν„΄
"[[λ…ΈνΈ]]" β“
"[[note-name]]" β“
"[[Note_Name]]" β“
"[[λ‹¤μ¤‘ λ‹¨μ–΄ λ…ΈνΈ]]" β“
"[[λ…ΈνΈ|ν‘μ‹]]" β“
"μ•κΈ€[[λ…ΈνΈ]]λ’·κΈ€" β“

// λ§¤μΉ­ μ• λμ–΄μ•Ό ν•λ” ν¨ν„΄
"[λ…ΈνΈ]" β— (λ‹¨μΌ κ΄„νΈ)
"[[ ]]" β— (κ³µλ°±λ§)
"[[]]" β— (λΉ κ΄„νΈ)
"[[λ…ΈνΈ" β— (λ‹«νμ§€ μ•μ€ κ΄„νΈ)
```

### μ„±λ¥ κΈ°μ¤€

- μλ™μ™„μ„± μ‘λ‹µ: < 200ms
- νμ‹± (1000κΈ€μ): < 50ms
- λ§ν¬ μƒμ„±: < 500ms

---

## π¨ UI/UX μ¤ν™

### ν•νƒ 1: νΌ μ…λ ¥ μ¤‘

```
λ‚΄μ© μ…λ ¥:
"[[Machine" μ…λ ¥ μ¤‘
β†“
λ“λ΅­λ‹¤μ΄:
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ Machine Learning    β”‚ (μ„ νƒ κ°€λ¥)
β”‚ Mathematical...     β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

### ν•νƒ 2: μ„ν‚¤λ§ν¬ ν•μ΄λΌμ΄νΈ

```
μ •μƒ λ§ν¬: [[Machine Learning]] β† μ΄λ΅μƒ‰
λ―Έλ§¤μΉ­: [[NonExistent]] β† μ£Όν™©μƒ‰
```

### ν•νƒ 3: λ…ΈνΈ μƒμ„Έ νμ΄μ§€

```
λ³Έλ¬Έ:
μ΄κ²ƒμ€ Machine Learning κ°λ…μ…λ‹λ‹¤.
(Machine Learningμ΄ λ§ν¬λ΅ ν‘μ‹)

ν΄λ¦­ β†’ /notes/uuid-1λ΅ μ΄λ™
```

---

## π¨ μ—λ¬ μ²λ¦¬

| μƒν™© | μ²λ¦¬ |
|------|------|
| μ„λ²„ μ—λ¬ | 500: λ§ν¬ μƒμ„± μ·¨μ†, κ²½κ³  λ©”μ‹μ§€ |
| μ¤‘λ³µ λ§ν¬ | 409: λ¬΄μ‹ (μ΄λ―Έ μ΅΄μ¬) |
| λ…ΈνΈ μ—†μ | κ²½κ³ λ§ ν‘μ‹, κ³„μ† μ§„ν–‰ |
| νμ‹± μ‹¤ν¨ | μ‚¬μ©μ μλ™ λ§ν¬ μƒμ„± κ°€λ¥ |

---

## π“ λ…ΈνΈ

- **λ³΄μ•**: SQL injection λ°©μ§€ (Supabase μλ™ μ²λ¦¬)
- **μ„±λ¥**: μΈλ±μ‹±λ title μ»¬λΌμΌλ΅ κ²€μƒ‰
- **ν™•μ¥μ„±**: ν–¥ν›„ alias, hashtag μ§€μ› κ°€λ¥

---

**μƒνƒ**: μ¤€λΉ„ μ™„λ£ (κµ¬ν„ μ‹μ‘ κ°€λ¥)
